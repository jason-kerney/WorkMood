<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="WorkMood.MauiApp.Pages.Visualization"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:WorkMood.MauiApp.Converters"
             Title="Mood Visualization">
    
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertedBoolConverter x:Key="InvertedBoolConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    
    <Grid>
        <!-- Main content -->
        <ScrollView IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
            <StackLayout Padding="20" Spacing="20">
            
            <!-- Page Header -->
            <Label Text="2-Week Mood Trends" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center" 
                   Margin="0,0,0,10"/>
            
            <!-- Date Range Info -->
            <Label x:Name="DateRangeLabel" 
                   Text="{Binding DateRangeText}" 
                   FontSize="16" 
                   HorizontalOptions="Center" 
                   TextColor="Gray"/>
            
            <!-- Visualization Container -->
            <Frame BackgroundColor="White" 
                   HasShadow="True" 
                   Padding="15" 
                   CornerRadius="10"
                   Margin="0,10,0,20">
                
                <StackLayout>
                    <!-- Legend -->
                    <Label Text="Legend:" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           Margin="0,0,0,10"/>
                    
                    <Grid ColumnDefinitions="*,*" 
                          RowDefinitions="Auto,Auto,Auto,Auto" 
                          Margin="0,0,0,15">
                        
                        <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="10">
                            <BoxView Color="LimeGreen" WidthRequest="20" HeightRequest="20"/>
                            <Label Text="Significantly Improved" VerticalOptions="Center" FontSize="12"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Spacing="10">
                            <BoxView Color="LightGreen" WidthRequest="20" HeightRequest="20"/>
                            <Label Text="Improved" VerticalOptions="Center" FontSize="12"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="10">
                            <BoxView Color="LightBlue" WidthRequest="20" HeightRequest="20"/>
                            <Label Text="No Change" VerticalOptions="Center" FontSize="12"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="10">
                            <BoxView Color="LightCoral" WidthRequest="20" HeightRequest="20"/>
                            <Label Text="Declined" VerticalOptions="Center" FontSize="12"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Spacing="10">
                            <BoxView Color="Red" WidthRequest="20" HeightRequest="20"/>
                            <Label Text="Significantly Declined" VerticalOptions="Center" FontSize="12"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="10">
                            <BoxView Color="LightGray" WidthRequest="20" HeightRequest="20"/>
                            <Label Text="No Data" VerticalOptions="Center" FontSize="12"/>
                        </StackLayout>
                    </Grid>
                    
                    <!-- Visualization Canvas -->
                    <Frame BackgroundColor="White" 
                           BorderColor="Gray" 
                           HasShadow="False" 
                           Padding="10" 
                           CornerRadius="5">
                        
                        <Grid x:Name="VisualizationGrid" 
                              ColumnDefinitions="*,*,*,*,*,*,*,*,*,*,*,*,*,*"
                              RowDefinitions="Auto,100,Auto"
                              MinimumHeightRequest="140">
                            
                            <!-- Day labels will be added programmatically -->
                            <!-- Bar chart will be added programmatically -->
                            
                        </Grid>
                    </Frame>
                </StackLayout>
            </Frame>
            
            <!-- Summary Information -->
            <Frame BackgroundColor="LightBlue" 
                   HasShadow="True" 
                   Padding="15" 
                   CornerRadius="10">
                
                <StackLayout>
                    <Label Text="Summary" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           Margin="0,0,0,10"/>
                    
                    <Label x:Name="SummaryLabel" 
                           Text="{Binding SummaryText}" 
                           FontSize="14" 
                           LineBreakMode="WordWrap"/>
                </StackLayout>
            </Frame>
            
            <!-- Detailed Data List -->
            <Frame BackgroundColor="White" 
                   HasShadow="True" 
                   Padding="15" 
                   CornerRadius="10">
                
                <StackLayout>
                    <Label Text="Daily Details" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           Margin="0,0,0,10"/>
                    
                    <CollectionView ItemsSource="{Binding DailyDataItems}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="80,20,*,Auto" 
                                      RowDefinitions="Auto" 
                                      Padding="5">
                                    
                                    <!-- Date label -->
                                    <Label Grid.Column="0" 
                                           Text="{Binding DateString}" 
                                           VerticalOptions="Center" 
                                           FontSize="12"/>
                                    
                                    <!-- Color indicator -->
                                    <BoxView Grid.Column="1" 
                                             Color="{Binding Color}" 
                                             WidthRequest="15" 
                                             HeightRequest="15" 
                                             VerticalOptions="Center" 
                                             CornerRadius="2"/>
                                    
                                    <!-- Description -->
                                    <Label Grid.Column="2" 
                                           Text="{Binding Description}" 
                                           VerticalOptions="Center" 
                                           FontSize="12"/>
                                    
                                    <!-- Value (only if has data) -->
                                    <Label Grid.Column="3" 
                                           Text="{Binding ValueString}" 
                                           VerticalOptions="Center" 
                                           FontSize="12" 
                                           TextColor="Gray"
                                           IsVisible="{Binding HasData}"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>
            
            <!-- Navigation Buttons -->
            <StackLayout Orientation="Horizontal" 
                         HorizontalOptions="Center" 
                         Spacing="20" 
                         Margin="0,20,0,0">
                
                <Button Text="Back to History" 
                        Command="{Binding BackToHistoryCommand}" 
                        BackgroundColor="LightGray" 
                        TextColor="Black" 
                        WidthRequest="150"/>
                
                <Button Text="Refresh Data" 
                        Command="{Binding RefreshCommand}" 
                        BackgroundColor="CornflowerBlue" 
                        TextColor="White" 
                        WidthRequest="150"/>
            </StackLayout>
            
            </StackLayout>
        </ScrollView>
        
        <!-- Loading indicator -->
        <StackLayout IsVisible="{Binding IsLoading}" 
                     HorizontalOptions="Center" 
                     VerticalOptions="Center">
            <ActivityIndicator IsRunning="{Binding IsLoading}" 
                              Color="CornflowerBlue" 
                              WidthRequest="50" 
                              HeightRequest="50"/>
            <Label Text="Loading visualization..." 
                   HorizontalOptions="Center" 
                   TextColor="Gray" 
                   FontSize="16" 
                   Margin="0,10,0,0"/>
        </StackLayout>
    </Grid>
</ContentPage>