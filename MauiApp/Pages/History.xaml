<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WorkMood.MauiApp.Pages.History"
             Title="Mood History">

    <Grid RowDefinitions="Auto,Auto,*" Padding="20">
        
        <!-- Header -->
        <StackLayout Grid.Row="0" Spacing="10" Margin="0,0,0,20">
            <Label Text="📊 Mood History &amp; Analytics" 
                   Style="{StaticResource Headline}"
                   HorizontalOptions="Center"
                   SemanticProperties.HeadingLevel="Level1" />
        </StackLayout>

        <!-- Statistics Summary -->
        <Border Grid.Row="1" 
                BackgroundColor="{StaticResource Gray100}" 
                Padding="20" 
                StrokeThickness="0"
                StrokeShape="RoundRectangle 10"
                Margin="0,0,0,20">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,*" ColumnSpacing="20" RowSpacing="10">
                
                <Label Grid.Row="0" Grid.ColumnSpan="2"
                       Text="📈 Statistics" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />
                
                <StackLayout Grid.Row="1" Grid.Column="0">
                    <Label Text="Total Entries" FontAttributes="Bold" />
                    <Label Text="{Binding TotalEntries}" FontSize="20" TextColor="{StaticResource Primary}" />
                </StackLayout>
                
                <StackLayout Grid.Row="1" Grid.Column="1">
                    <Label Text="Overall Average" FontAttributes="Bold" />
                    <Label Text="{Binding OverallAverage}" FontSize="20" TextColor="{StaticResource Primary}" />
                </StackLayout>
                
                <StackLayout Grid.Row="2" Grid.Column="0">
                    <Label Text="Last 7 Days" FontAttributes="Bold" />
                    <Label Text="{Binding Last7Days}" FontSize="20" TextColor="{StaticResource Secondary}" />
                </StackLayout>
                
                <StackLayout Grid.Row="2" Grid.Column="1">
                    <Label Text="Last 30 Days" FontAttributes="Bold" />
                    <Label Text="{Binding Last30Days}" FontSize="20" TextColor="{StaticResource Secondary}" />
                </StackLayout>
                
                <StackLayout Grid.Row="3" Grid.ColumnSpan="2" Spacing="10">
                    <Label Text="Trend" FontAttributes="Bold" HorizontalOptions="Center" />
                    <Label Text="{Binding Trend}" FontSize="18" HorizontalOptions="Center" TextColor="{Binding TrendColor}" />
                    
                    <!-- Visualization Button -->
                    <Button Text="📊 View 2-Week Visualization" 
                            Command="{Binding OpenVisualizationCommand}"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            Margin="10,10,10,0"
                            CornerRadius="8"/>
                </StackLayout>
                
            </Grid>
        </Border>

        <!-- History List -->
        <ScrollView Grid.Row="2">
            <StackLayout Spacing="10">
                
                <Label Text="🗓️ Recent Entries" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       Margin="0,0,0,10" />
                
                <!-- Loading Indicator -->
                <ActivityIndicator IsVisible="{Binding IsLoading}" 
                                   IsRunning="{Binding IsLoading}"
                                   HorizontalOptions="Center" 
                                   Margin="0,20" />
                
                <!-- No Data Message -->
                <Label Text="No mood entries found."
                       FontSize="16"
                       TextColor="Gray"
                       HorizontalOptions="Center"
                       Margin="0,20"
                       IsVisible="{Binding HasNoData}" />
                
                <!-- Error Message -->
                <Label Text="{Binding ErrorMessage}"
                       FontSize="14"
                       TextColor="Red"
                       HorizontalOptions="Center"
                       Margin="0,20"
                       IsVisible="{Binding HasError}" />
                
                <!-- Recent Entries Container -->
                <StackLayout x:Name="HistoryEntriesStack" Spacing="5">
                    <!-- Entries will be added programmatically using the factory -->
                </StackLayout>
                
            </StackLayout>
        </ScrollView>
        
    </Grid>

</ContentPage>