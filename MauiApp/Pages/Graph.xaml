<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="WorkMood.MauiApp.Pages.Graph"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:WorkMood.MauiApp.Models"
             xmlns:viewmodels="clr-namespace:WorkMood.MauiApp.ViewModels"
             x:DataType="viewmodels:GraphViewModel"
             Title="Mood Graph">
    
    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Date Range Selection -->
        <StackLayout Grid.Row="0" Orientation="Horizontal" Spacing="10" Margin="0,0,0,20">
            <Label Text="Date Range:" VerticalOptions="Center" />
            <Picker x:Name="DateRangePicker"
                    ItemsSource="{Binding DateRanges}"
                    SelectedItem="{Binding SelectedDateRange}"
                    ItemDisplayBinding="{Binding DisplayName}"
                    VerticalOptions="Center"
                    MinimumWidthRequest="200" />
            <CheckBox IsChecked="{Binding ShowDataPoints}"
                      VerticalOptions="Center"
                      Margin="20,0,0,0" />
            <Label Text="Show Data Points"
                   VerticalOptions="Center"
                   Margin="5,0,0,0" />
            <CheckBox IsChecked="{Binding ShowAxesAndGrid}"
                      VerticalOptions="Center"
                      Margin="20,0,0,0" />
            <Label Text="Show Axes &amp; Grid"
                   VerticalOptions="Center"
                   Margin="5,0,0,0" />
            <CheckBox IsChecked="{Binding ShowTitle}"
                      VerticalOptions="Center"
                      Margin="20,0,0,0" />
            <Label Text="Show Title"
                   VerticalOptions="Center"
                   Margin="5,0,0,0" />
        </StackLayout>
        
        <!-- Custom Background Controls -->
        <StackLayout Grid.Row="1" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
            <Button Text="Load Background"
                    Command="{Binding LoadCustomBackgroundCommand}"
                    BackgroundColor="Purple"
                    TextColor="White"
                    HorizontalOptions="Start" />
            <Button Text="Clear Background"
                    Command="{Binding ClearCustomBackgroundCommand}"
                    BackgroundColor="Gray"
                    TextColor="White"
                    HorizontalOptions="Start"
                    IsVisible="{Binding HasCustomBackground}" />
            <Label Text="Custom Background Loaded"
                   VerticalOptions="Center"
                   TextColor="Purple"
                   FontAttributes="Bold"
                   IsVisible="{Binding HasCustomBackground}" />
        </StackLayout>
        
        <!-- Graph Display -->
        <Border Grid.Row="2"
                Stroke="Gray"
                StrokeThickness="1"
                BackgroundColor="White"
                Padding="10"
                Margin="0,10">
            <ScrollView>
                <Image Source="{Binding GraphImageSource}"
                       Aspect="AspectFit"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       HeightRequest="400"
                       WidthRequest="{Binding DisplayWidth}"
                       IsVisible="{Binding HasGraphData}" />
            </ScrollView>
        </Border>
        
        <!-- No Data Message -->
        <Label Grid.Row="2"
               Text="No mood data available for the selected period"
               FontSize="16"
               TextColor="Gray"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               IsVisible="{Binding HasNoData}" />
        
        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="2"
                          IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          Color="Blue"
                          HorizontalOptions="Center"
                          VerticalOptions="Center" />
        
        <!-- Action Buttons -->
        <StackLayout Grid.Row="3" Orientation="Horizontal" Spacing="20" Margin="0,20,0,0">
            <Button Text="Export PNG"
                    Command="{Binding ExportGraphCommand}"
                    BackgroundColor="DarkBlue"
                    TextColor="White"
                    HorizontalOptions="Start" />
            <Button Text="Share Graph"
                    Command="{Binding ShareGraphCommand}"
                    BackgroundColor="Green"
                    TextColor="White"
                    HorizontalOptions="Start" />
            <Label Text="{Binding StatusMessage}"
                   VerticalOptions="Center"
                   TextColor="DarkGreen"
                   IsVisible="{Binding HasStatusMessage}" />
        </StackLayout>
        
    </Grid>
</ContentPage>